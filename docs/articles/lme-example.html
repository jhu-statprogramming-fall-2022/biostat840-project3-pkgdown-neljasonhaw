<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nlme">
<title>Example Analysis • nlme</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.4/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.4/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example Analysis">
<meta property="og:description" content="nlme">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">nlme</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.1-160</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/lme-example.html">Example Analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example Analysis</h1>
            
      
      
      <div class="d-none name"><code>lme-example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://svn.r-project.org/R-packages/trunk/nlme/" class="external-link">nlme</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<p>In this vignette, we demonstrate how to conduct a linear mixed model
using the <code>nlme</code> package.</p>
<p>Here, we use data featured in TidyTuesday Podcast Episode 16: College
Tuition](<a href="https://www.tidytuesday.com/16" class="external-link uri">https://www.tidytuesday.com/16</a>). This is a longitudinal
data set of tuition fees from the National Center of Education
Statistics (NCES). Instructions for downloading the data, as well as the
data dictionary are available <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2020/2020-03-10" class="external-link">here</a>.
We will use the <code>tuition_income.csv</code> file.</p>
<p>We will aim to answer the question: What is the mean change in
on-campus tuition prices from 2014 to 2018 across U.S. universities? We
will also answer two sub-questions: (1) What is the mean on-campus
tuition price every year from 2014 to 2018 per state, and (2) What is
the mean five-year change in on-campus tuition price for every
state?</p>
<p>We first read the data in:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store the name of the csv on TidyTuesday github</span></span>
<span><span class="va">tuition_income_url</span> <span class="op">&lt;-</span> <span class="st">"tuition_income.csv"</span></span>
<span></span>
<span><span class="co"># Test if a directory named data exists locally (will create if it doesn't exist)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span>,</span>
<span>       <span class="st">"Directory is already created"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Directory is already created"</span></span>
<span></span>
<span><span class="co"># Read the data only once</span></span>
<span><span class="va">tuition_income_path</span> <span class="op">&lt;-</span> <span class="st">"data/tuition_income.Rdata"</span></span>
<span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">tuition_income_path</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">tuition_income</span> <span class="op">&lt;-</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-03-10/"</span>, <span class="va">tuition_income_url</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">janitor</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/janitor/man/clean_names.html" class="external-link">clean_names</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/save.html" class="external-link">save</a></span><span class="op">(</span><span class="va">tuition_income</span>, file <span class="op">=</span> <span class="va">tuition_income_path</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">tuition_income_path</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We first subset our dataset to retrieve only data for the years from
2014 to 2016 and on campus tuition prices. Since the data set is further
stratified by the net price by income bracket, we retrieve only the
first observation within each school.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Filter data from 2014 to 2018 and only on-campus tuition</span></span>
<span><span class="va">tuition_income_1418_oc</span> <span class="op">&lt;-</span> <span class="va">tuition_income</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2014</span><span class="op">:</span><span class="fl">2018</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">campus</span> <span class="op">==</span> <span class="st">"On Campus"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1L</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">state</span>, <span class="va">total_price</span>, <span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tuition_income_1418_oc</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9,743 × 4</span></span></span>
<span><span class="co">#&gt;    name                              state total_price  year</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Piedmont International University NC          <span style="text-decoration: underline;">20</span>174  <span style="text-decoration: underline;">2</span>016</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Piedmont International University NC          <span style="text-decoration: underline;">20</span>514  <span style="text-decoration: underline;">2</span>017</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Piedmont International University NC          <span style="text-decoration: underline;">20</span>829  <span style="text-decoration: underline;">2</span>018</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Yeshiva Gedolah Shaarei Shmuel    NJ          <span style="text-decoration: underline;">14</span>010  <span style="text-decoration: underline;">2</span>016</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Yeshiva Gedolah Shaarei Shmuel    NJ          <span style="text-decoration: underline;">14</span>010  <span style="text-decoration: underline;">2</span>017</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Yeshiva Gedolah Shaarei Shmuel    NJ          <span style="text-decoration: underline;">14</span>900  <span style="text-decoration: underline;">2</span>018</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Beth Medrash of Asbury Park       NJ          <span style="text-decoration: underline;">16</span>300  <span style="text-decoration: underline;">2</span>016</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Beth Medrash of Asbury Park       NJ          <span style="text-decoration: underline;">16</span>300  <span style="text-decoration: underline;">2</span>017</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Beth Medrash of Asbury Park       NJ          <span style="text-decoration: underline;">18</span>940  <span style="text-decoration: underline;">2</span>018</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Elim Bible Institute and College  NY          <span style="text-decoration: underline;">14</span>268  <span style="text-decoration: underline;">2</span>016</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 9,733 more rows</span></span></span></code></pre></div>
<p>We answer the first question: What is the mean on-campus tuition
price every year from 2014 to 2018 per state?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a data set per year</span></span>
<span><span class="va">tuition_income_1418_oc_byyear</span> <span class="op">&lt;-</span> <span class="va">tuition_income_1418_oc</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">tuition_income_1418_oc</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a function that calculates the mean tuition by state and stores in a data frame</span></span>
<span><span class="va">meantuition_state</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># x: index of list in tuition_income_1418_oc_byyear</span></span>
<span>  <span class="va">means</span> <span class="op">&lt;-</span> <span class="va">tuition_income_1418_oc_byyear</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">tuition_income_1418_oc_byyear</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">state</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.x</span><span class="op">$</span><span class="va">total_price</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">means</span><span class="op">)</span>,</span>
<span>             meantuition <span class="op">=</span> <span class="va">means</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,</span>
<span>             year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">tuition_income_1418_oc_byyear</span><span class="op">[</span><span class="va">x</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Apply the function to each year and store in one data frame</span></span>
<span><span class="va">meantuition_yearstate</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dfr</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, .f <span class="op">=</span> <span class="va">meantuition_state</span><span class="op">)</span></span></code></pre></div>
<p>We then present the results in a choropleth map, by year:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Match the state abbreviation with the state name</span></span>
<span><span class="va">meantuition_yearstate</span> <span class="op">&lt;-</span> <span class="va">meantuition_yearstate</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>region <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">state.name</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">state.abb</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve the states map data and merge with mean tuition data</span></span>
<span><span class="va">states_map</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span></span>
<span><span class="va">meantuition_yearstate_map</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">states_map</span>, <span class="va">meantuition_yearstate</span>, by <span class="op">=</span> <span class="st">"region"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create the choropleth map</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">meantuition_yearstate_map</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">long</span>, <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">meantuition</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">year</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"Mean tuition"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mean tuition cost was highest in the Northeast from 2014-2018"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Mean tuition did not change much across states"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Tuitiion cost data from National Center of Education Statistics (NCES)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.1</span><span class="op">)</span>, legend.justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="lme-example_files/figure-html/map1-1.png" width="768">
We see that the highest tuition costs were in the Northeast: Washington
DC, Rhode Island, and Massachusetts had average four-year college
tuition costs at more than 50,000 USD a year. On the other hand,
Wyoming, Mississippi, and North Dakota had the lowest tuition costs at
less than 15,000 USD a year.</p>
<p>We then answer the second question: What is the mean five-year change
in on-campus tuition price for every state?</p>
<p>First, we visualize the tuition cost every year for each school using
a spaghetti plot, highlighting the highest three and lowest three states
we mentioned earlier.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tuition_income_1418_oc_hh</span> <span class="op">&lt;-</span> <span class="va">tuition_income_1418_oc</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>highlight <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">state</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DC"</span>, <span class="st">"RI"</span>, <span class="st">"MA"</span>, <span class="st">"ND"</span>, <span class="st">"MS"</span>, <span class="st">"WY"</span><span class="op">)</span>, <span class="va">state</span>, <span class="st">""</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">highlight</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">tuition_income_1418_oc_hh</span>, </span>
<span>       <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">name</span>, x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">total_price</span>, </span>
<span>           color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">highlight</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">highlight</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"DC"</span>, <span class="st">"RI"</span>, <span class="st">"MA"</span>, <span class="st">"ND"</span>, <span class="st">"MS"</span>, <span class="st">"WY"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gray"</span>, <span class="st">"#4040DB"</span>, <span class="st">"#7D52F2"</span>, <span class="st">"#9340DB"</span>,</span>
<span>                                <span class="st">"#DE5445"</span>, <span class="st">"#F57C59"</span>, <span class="st">"#DE7845"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_alpha_manual</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"DC"</span>, <span class="st">"RI"</span>, <span class="st">"MA"</span>, <span class="st">"ND"</span>, <span class="st">"MS"</span>, <span class="st">"WY"</span><span class="op">)</span>,</span>
<span>                     values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span>, alpha <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"Year"</span>, y <span class="op">=</span> <span class="st">"On-campus tuition cost"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Tuition costs were increasing across all schools in the United States"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Top 3 highest and lowest cost states remained in their ranks across time"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Tuition cost data from National Center of Education Statistics (NCES)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>, face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="lme-example_files/figure-html/spagplot-1.png" width="768">
We then run two candidate models: a random intercept model with year and
state as covariates, and another adding year*state interaction terms. We
use the <code>lme</code> function to run the models, and the
<code>anova.lme</code> function to compare the models using a likelihood
ratio test from the <code>nlme</code> package.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Random intercept model without interaction term</span></span>
<span><span class="va">model_noint</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lme.html">lme</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">total_price</span> <span class="op">~</span> <span class="va">year</span> <span class="op">+</span> <span class="va">state</span>,</span>
<span>                 random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">name</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">tuition_income_1418_oc</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"ML"</span><span class="op">)</span> <span class="co"># ML to allow likelihood ratio test instead of default REML</span></span>
<span></span>
<span><span class="co"># Random intercept model with interaction term</span></span>
<span><span class="va">model_int</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lme.html">lme</a></span><span class="op">(</span>fixed <span class="op">=</span> <span class="va">total_price</span> <span class="op">~</span> <span class="va">year</span><span class="op">*</span><span class="va">state</span>,</span>
<span>                 random <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">|</span> <span class="va">name</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">tuition_income_1418_oc</span>,</span>
<span>                 method <span class="op">=</span> <span class="st">"ML"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Likelihood ratio test</span></span>
<span><span class="fu"><a href="../reference/anova.lme.html">anova.lme</a></span><span class="op">(</span><span class="va">model_int</span>, <span class="va">model_noint</span><span class="op">)</span></span>
<span><span class="co">#&gt;             Model  df      AIC      BIC    logLik   Test  L.Ratio p-value</span></span>
<span><span class="co">#&gt; model_int       1 104 181883.1 182630.2 -90837.54                        </span></span>
<span><span class="co">#&gt; model_noint     2  54 182340.2 182728.2 -91116.12 1 vs 2 557.1594  &lt;.0001</span></span></code></pre></div>
<p>We see that the model with year*state interaction terms significantly
improve model fit, so we use this model to estimate the mean annual
change of tuition cost for each state.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve the coefficients</span></span>
<span><span class="va">year_coef</span> <span class="op">&lt;-</span> <span class="va">model_int</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">fixed</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Retrieve the state coefficients</span></span>
<span><span class="co"># Note that AK is the "comparison" state, so their coefficient is just 0</span></span>
<span><span class="va">states_coef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">model_int</span><span class="op">$</span><span class="va">coefficients</span><span class="op">$</span><span class="va">fixed</span><span class="op">[</span><span class="fl">53</span><span class="op">:</span><span class="fl">102</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve the state coefficient names</span></span>
<span><span class="va">states_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">tuition_income_1418_oc</span><span class="op">$</span><span class="va">state</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Calculate the annual change in tuition cost per year per state</span></span>
<span><span class="va">states_change</span> <span class="op">&lt;-</span> <span class="va">states_coef</span> <span class="op">|&gt;</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">+</span> <span class="va">year_coef</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Assemble in a data frame</span></span>
<span><span class="va">states_change_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>state <span class="op">=</span> <span class="va">states_names</span>,</span>
<span>                               meanchange <span class="op">=</span> <span class="va">states_change</span><span class="op">)</span></span></code></pre></div>
<p>We then present the results using a bar graph, ranked by mean annual
change:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">states_change_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">meanchange</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/reorder.factor.html" class="external-link">reorder</a></span><span class="op">(</span><span class="va">state</span>, <span class="va">meanchange</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"identity"</span>, color <span class="op">=</span> <span class="st">"gray"</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">""</span>, alpha <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="st">"Mean annual increase in tuition cost (USD)"</span>, y <span class="op">=</span> <span class="st">""</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Mean annual increase in tuition cost ranged from 300 to 1,700 USD across states"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Top 3 highest states were Rhode Island, Massachusetts, and Washington DC"</span>,</span>
<span>       caption <span class="op">=</span> <span class="st">"Tuition cost data from National Center of Education Statistics (NCES)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>        axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">12</span>, face <span class="op">=</span> <span class="st">"bold"</span><span class="op">)</span>,</span>
<span>        axis.line <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_line</a></span><span class="op">(</span>linewidth <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">16</span>, face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        plot.subtitle <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span>, face <span class="op">=</span> <span class="st">"bold"</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="lme-example_files/figure-html/plotmeanchange-1.png" width="768"></p>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>Based from data on the National Center of Education Statistics (NCES)
from 2014 to 2018, all schools increased their on-campus tuition cost
for a four-year undergraduate degree. The highest costs, as well as the
highest mean annual change in cost, were in Rhode Island, Massachusetts,
and Washington DC.</p>
</div>
<div class="section level2">
<h2 id="functions-used">Functions used<a class="anchor" aria-label="anchor" href="#functions-used"></a>
</h2>
<ul>
<li>
<code>nlme</code>: <code>lme</code>, <code>anova.lme</code>
</li>
<li>
<code>dplyr</code>: <code>arrange</code>, <code>filter</code>,
<code>group_by</code>, <code>left_join</code>, <code>mutate</code>,
<code>select</code>, <code>ungroup</code>
</li>
<li>
<code>purrr</code>: <code>map_dfr</code>, <code>map_dbl</code>
</li>
<li>
<code>ggplot2</code> geoms: <code>geom_polygon</code>,
<code>geom_line</code>
</li>
<li>
<code>readr</code>: <code>read_csv</code>
</li>
<li>
<code>janitor</code>: <code>clean_names</code>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by José Pinheiro, Douglas Bates, R Core Team.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
